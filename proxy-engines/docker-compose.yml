version: "3.8"

services:
  customer-site:
    image: python:3.11-slim
    container_name: app-site
    working_dir: /app
    volumes:
      - ./:/app:rw
    environment:
      - PYTHONUNBUFFERED=1
      - PORT=443
    ports:
      - "8443:443"
    command: bash -lc "pip install --no-cache-dir -r requirements.txt >/dev/null 2>&1 || true && python -u app.py"
    restart: unless-stopped
    networks:
      - cf-20251118

  proxy-server-fl-bot-manager-off:
    image: python:3.11-slim
    container_name: proxy-server-fl-bot-manager-off
    working_dir: /app
    volumes:
      - ./:/app:rw
    environment:
      - PYTHONUNBUFFERED=1
      - IS_BOT_MANAGER_ON=false
      - PORT=50001
    ports:
      - "50001:50001"
    command: bash -lc "pip install --no-cache-dir -r requirements.txt >/dev/null 2>&1 || true && python -u fl.py"
    restart: unless-stopped
    networks:
      - cf-20251118

  proxy-server-fl-bot-manager-on:
    image: python:3.11-slim
    container_name: proxy-server-fl-bot-manager-on
    working_dir: /app
    volumes:
      - ./:/app:rw
    environment:
      - PYTHONUNBUFFERED=1
      - IS_BOT_MANAGER_ON=true
      - PORT=50002
    ports:
      - "50002:50001"
    command: bash -lc "pip install --no-cache-dir -r requirements.txt >/dev/null 2>&1 || true && python -u fl.py"
    restart: unless-stopped
    networks:
      - cf-20251118

  proxy-server-fl2:
    image: python:3.11-slim
    container_name: proxy-server-fl2
    working_dir: /app
    volumes:
      - ./:/app:rw
    environment:
      - PYTHONUNBUFFERED=1
      - PORT=50003
    ports:
      - "50003:50001"
    command: bash -lc "pip install --no-cache-dir -r requirements.txt >/dev/null 2>&1 || true && python -u fl2.py"
    restart: unless-stopped
    networks:
      - cf-20251118

networks:
  cf-20251118:
    external: true